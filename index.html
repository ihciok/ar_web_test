<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>A-Frame PDF Viewer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
</head>
<body>
    <a-scene>
        <!-- PDF表示用のエンティティ -->
        <a-entity id="pdf-viewer" position="0 1.6 -2"></a-entity>

        <!-- ページ遷移用ボタン -->
        <a-entity id="prev-page" position="-1 1.6 -1" geometry="primitive: plane; width: 0.5; height: 0.2" material="color: blue" pdf-button="action: prev"></a-entity>
        <a-entity id="next-page" position="1 1.6 -1" geometry="primitive: plane; width: 0.5; height: 0.2" material="color: red" pdf-button="action: next"></a-entity>

        <a-entity id="pdf-viewer" pdf-viewer="url: img/sample.pdf" position="0 1.6 -2"></a-entity>

    </a-scene>

    <!-- PDF表示とページ遷移のためのスクリプト -->
    <script>
        // ここにJavaScriptコードを追加
        AFRAME.registerComponent('pdf-viewer', {
            schema: {
                url: {type: 'string'}
            },
            init: function () {
                const el = this.el;
                const data = this.data;
                let pdfDoc = null;
                let pageNum = 1;

                pdfjsLib.getDocument(data.url).promise.then(function(pdfDoc_) {
                    pdfDoc = pdfDoc_;
                    renderPage(pageNum);
                });

                function renderPage(num) {
                    pdfDoc.getPage(num).then(function(page) {
                        var viewport = page.getViewport({scale: 2.0});
                        var canvas = document.createElement('canvas');
                        var ctx = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        var renderContext = {
                            canvasContext: ctx,
                            viewport: viewport
                        };
                        page.render(renderContext).promise.then(function () {
                            const texture = new THREE.Texture(canvas);
                            texture.needsUpdate = true;
                            el.setObject3D('mesh', new THREE.Mesh(
                                new THREE.PlaneGeometry(viewport.width / 200, viewport.height / 200),
                                new THREE.MeshBasicMaterial({map: texture})
                            ));
                        });
                    });
                }

                // ページ遷移のためのイベントリスナー
                document.getElementById('next-page').addEventListener('click', function () {
                    if (pageNum >= pdfDoc.numPages) return;
                    pageNum++;
                    renderPage(pageNum);
                });

                document.getElementById('prev-page').addEventListener('click', function () {
                    if (pageNum <= 1) return;
                    pageNum--;
                    renderPage(pageNum);
                });
            }
        });

        // ページ遷移用ボタンのコンポーネントを追加（必要に応じて）

    </script>
</body>
</html>
